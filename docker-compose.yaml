version: '3.9'
services:
  alphafold3:
    container_name: alphafold3_container
    build:
      context: ./3rdparty/alphafold3
      dockerfile: ./docker/Dockerfile
    volumes:
      - ./data/input:/root/af_input
      - ./data/output/alphafold3:/root/af_output
      - ./af3_model_parameters:/root/models
      - ./af_public_databases:/root/public_databases

  megadock:
    container_name: megadock_container
    build:
      context: ./3rdparty/magadock
      dockerfile: ./../../docker/megadock/Dockerfile
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    volumes:
      - ./data/output/alphafold3/receptor:/app/input/receptor
      - ./data/output/alphafold3/ligand:/app/input/ligand
      - ./data/output/megadock:/app/output

    working_dir: /app
    tty: true
    stdin_open: true
    command: [ "sleep", "infinity" ]

  prodigy:
    container_name: prodigy_container
    build:
      dockerfile: ./docker/prodigy/Dockerfile
    volumes:
      - ./data/output/megadock:/app/input
      - ./data/output/prodigy:/app/output
    working_dir: /app
    tty: true
    stdin_open: true
    command: [ "sleep", "infinity" ]
